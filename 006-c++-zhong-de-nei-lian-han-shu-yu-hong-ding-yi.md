#### C++ 中的内联函数 与 宏定义


<br>
#### 一、 什么是内联函数? 
**1、 使用 'inline' 修饰函数声明或者函数实现,可以使其变成内联函数.(建议声明和实现都增加inline 修饰)**
如下:

```
// 使用inline 修饰的函数就是内联函数 
inline int minus(int a, int b){
  return a - b;
}

class Person{
public:
  // 使用inline 修饰的函数就是内联函数
  inline int sum(int a, int b){
    return a + b;
  }
}

```
 






<br>
#### 二、 内联函数的特点

**1、编译器会将函数调用直接展开为函数体代码**
**2、内联函数可以减少函数调用的开销, 普通函数(非inline 函数)调用时要分配栈空间, 调用完毕要回收栈空间, 而内联函数调用时是将函数体直接, 因此就不存在函数调用栈操作了.**
**3、因为内联函数在真实调用时是将函数体展开, 因此会增加整体的代码量**

如下示例:
```
//定义内联函数
inline int sum(int a, int b){
  return a + b;
}

// 调用内联函数
int value = sum(3,4); 
//其汇编代码实际等价于,下面这句
int  value = 3 + 4; // 不存在函数调用,节约栈空间
```





<br>
#### 三、 优点
**因为内联函数在真实的调用时,是函数体展开,不存在栈空间的开销, 因此内联函数的效率要比普通函数高.**







<br>
#### 四、 缺点
**因为内联函数调用是函数体展开, 因此会导致代码量, 建议超过10 行的代码就不要写成内联函数了**



 
<br>
#### 五、内联函数注意点:
**1、 尽量不要内联超过10行代码的函数**
**2、 有些函数即使 被声明为 'inline' , 也不一定会被编译器内联,比如:`递归函数`**

** ( 也就是说,在函数前面加 inline修饰 ,仅仅是建议编译器把对应的函数编译为内联, 但实际是不是内联不一定)**








<br>
#### 六、什么情况下建议使用内联
**1、 函数代码比较少**
**2、函数调用频率高**(普通函数调用会有 入栈和出栈,频率高且消耗栈空间)

![](/assets/inline.png)







<br>
#### 七、内联函数和宏定义的相同点 和 区别?**

**1、内联函数和宏定义都可以减少函数调用的开销**
**2、对比宏定义,内联函数多了语法检测和函数特性(传参), 宏定义有可能导致意料之外的错误(当涉及到计算时)**

![](/assets/Snip20190112_3.png)

从上面可以看出,内联函相较宏定义的函数特性, 因此, 我们通常涉及到计算的使用尽量不要使用宏定义而使用内联函数,以免出现意外的bug.

**因此,在使用宏定义做计算时要谨慎. 在C++ 中一般计算优先考虑内联函数, 在考虑使用宏定义.**


